<div
  class="contain-user-login w-full h-screen flex justify-content-start align-items-center flex-column"
  style="background-color:#efefef">

  <div class="fondo-gris">
    <div style="width: 100%" class="flex flex-column align-items-center justify-content-start">
      <div class="btn-atras">
        <img (click)="volver()" src="/assets/iconicsnew/atras-cuenta.svg" alt="">
      </div>
      <div class="ayuda">
        <span>REESTABLECER<br>CONTRASEÑA</span>
      </div>

      <!-- INFO -->
      <div class="info-banner" role="status" aria-live="polite">
        <div class="info-dot"></div>
        <div class="info-text">
          <div class="info-title">Info</div>
          <div class="info-message">{{message}}</div>
        </div>
      </div>
      <!-- Texto legacy oculto por CSS -->
      <span class="mensaje">INFO: {{message}}</span>
    </div>
  </div>

  <div class="boxMoreMessage">
    <div class="box-content-login-info">
      <div class="box-login">

        <!-- ID Vendedor -->
        <span class="box-login-span">ID Vendedor:</span>
        <div class="cont-sd">
          <input
            #sellerId
            style="background-color: transparent; outline: none; border: 0; box-sizing: border-box;"
            placeholder="Id del Vendedor"
            (keydown.space)="$event.preventDefault()"
            (paste)="$event.preventDefault(); sellerId.value = (($event.clipboardData && $event.clipboardData.getData('text')) || '').split(' ').join(''); onIdChange($event)"
            (input)="onIdChange($event)"/>
        </div>

        <!-- Usuario -->
        <span class="box-login-span">Usuario:</span>
        <div class="cont-sd">
          <input
            #username
            style="background-color: transparent; outline: none; border: 0; box-sizing: border-box;"
            placeholder="Usuario"
            (keydown.space)="$event.preventDefault()"
            (paste)="$event.preventDefault(); username.value = (($event.clipboardData && $event.clipboardData.getData('text')) || '').split(' ').join(''); onUsernameChange($event)"
            (input)="onUsernameChange($event)"/>
        </div>

        <!-- Contraseña antigua -->
        <span class="box-login-span">Contraseña antigua:</span>
        <div class="cont-sd cont-sd-password">
          <input type="checkbox" #pwdOldToggle hidden />
          <input
            #oldPwd
            [type]="pwdOldToggle.checked ? 'text' : 'password'"
            style="background-color: transparent; outline: none; border: 0; box-sizing: border-box;"
            placeholder="********"
            (keydown.space)="$event.preventDefault()"
            (paste)="$event.preventDefault(); oldPwd.value = (($event.clipboardData && $event.clipboardData.getData('text')) || '').split(' ').join(''); onPasswordChange($event)"
            (input)="onPasswordChange($event)"/>
          <button type="button" class="toggle-pwd" (click)="pwdOldToggle.checked = !pwdOldToggle.checked">
            {{ pwdOldToggle.checked ? 'Ocultar' : 'Mostrar' }}
          </button>
        </div>

        <!-- Contraseña nueva -->
        <span class="box-login-span">Contraseña nueva:</span>
        <div class="cont-sd cont-sd-password">
          <input type="checkbox" #pwdNewToggle hidden />
          <input
            #newPwd
            [type]="pwdNewToggle.checked ? 'text' : 'password'"
            style="background-color: transparent; outline: none; border: 0; box-sizing: border-box;"
            placeholder="********"
            (keydown.space)="$event.preventDefault()"
            (paste)="$event.preventDefault(); newPwd.value = (($event.clipboardData && $event.clipboardData.getData('text')) || '').split(' ').join(''); onNewPasswordChange($event)"
            (input)="onNewPasswordChange($event)"/>
          <button type="button" class="toggle-pwd" (click)="pwdNewToggle.checked = !pwdNewToggle.checked">
            {{ pwdNewToggle.checked ? 'Ocultar' : 'Mostrar' }}
          </button>
        </div>

        <button
          [disabled]="first"
          class="bsolicitar"
          (click)="changePassword()">
          {{ two ? "CARGANDO" : "CAMBIAR CONTRASEÑA" }}
        </button>
      </div>
    </div>
  </div>

<!-- Modal de éxito + redirección (solo HTML) -->
<div class="modal-backdrop"
     [style.display]="((message || '').toLowerCase().includes('exitoso')) ? 'block' : 'none'">
</div>

<div class="modal"
     [style.display]="((message || '').toLowerCase().includes('exitoso')) ? 'grid' : 'none'"
     role="dialog" aria-modal="true" aria-labelledby="successTitle">

  <!-- Redirección automática a /login en 3s solo si aparece 'exitoso' -->
  <meta
    [attr.http-equiv]="((message || '').toLowerCase().includes('exitoso')) ? 'refresh' : null"
    [attr.content]="((message || '').toLowerCase().includes('exitoso')) ? '5;url=/login' : null">

  <h3 id="successTitle" class="modal-title">¡Cambio exitoso!</h3>
  <p class="modal-text">
    El cambio fue exitoso. Estás siendo redirigido al inicio.
    Puedes poner tu usuario y tu nueva clave e iniciar sesión.
  </p>
  <a href="/login" class="modal-link">Ir ahora</a>
</div>

<style>
  /* ===== INFO banner ===== */
  .info-banner{
    width: 90vw;
    margin: 2vw auto 1vw;
    padding: 2.6vw 3.2vw;
    border-radius: 4vw;
    display: flex;
    align-items: center;
    gap: 2.4vw;
    color: #fff;
    background: linear-gradient(135deg,#6a00ff 0%,#8c3dff 100%);
    box-shadow: 0 8px 24px rgba(106,0,255,.32);
    border: 1px solid rgba(255,255,255,.12);
  }
  .info-dot{ width:3.8vw; height:3.8vw; border-radius:50%; background:#00d1ff; box-shadow:0 0 0 3px rgba(0,209,255,.25); flex-shrink:0; }
  .info-text{ display:flex; flex-direction:column; }
  .info-title{ font-size:3.2vw; letter-spacing:.08em; text-transform:uppercase; opacity:.9; font-weight:700; margin-bottom:.4vw; }
  .info-message{ font-size:4vw; font-weight:600; }
  .mensaje{ display:none; } /* ocultamos texto legacy */

  /* ===== Estructura base ===== */
  .contain-user-login{ background-image:url('/assets/iconicsnew/fondo-olvide.svg'); background-position:top center; background-size:100%; background-repeat:no-repeat; }
  .btn-atras{ width:90%; height:9vh; }
  .btn-atras img{ width:15vw; height:100%; }
  .boxMoreMessage{ display:flex; flex-direction:column; align-items:center; }
  .box-content-login-info{ background-color:transparent; width:100vw; height:100%; display:flex; flex-direction:column; justify-content:flex-start; }
  .fondo-gris{
    background-color: transparent;
    background-image: url(/assets/iconicsnew/restablecer-cuenta.png);
    background-repeat: no-repeat;
    background-size: 38vw;
    background-position-y: 25vw;
    background-position-x: 60vw;
    width: 100%;
    height: 35vh;
    padding: 2vw 0;
    border-radius: 0 0 3vw 3vw;
  }
  .ayuda{ width:80%; display:flex; justify-content:space-between; align-items:center; }
  .ayuda span{ font-weight:600; font-size:7vw; font-family:sans-serif; color:#fff; }
  .box-login{ background-color:transparent; border-radius:5vw 5vw 0 0; width:100vw; display:flex; flex-direction:column; justify-content:flex-start; align-items:center; padding:4vw 0; }
  .box-login-span{ font-size:3.5vw; text-align:left; width:75%; color:#707070; }
  .cont-sd{ display:flex; justify-content:flex-start; align-items:center; background-color:#c8d0e1; border-radius:3vw; width:75%; padding:2.5vw 3vw 2.5vw 4vw; margin:3vw 0; }
  .cont-sd input{ width:100%; font-size:4vw; }

  /* Toggle mostrar/ocultar contraseña */
  .cont-sd-password{ gap: 2vw; }
  .toggle-pwd{ border:0; outline:0; background:#ffffff; padding:1.2vw 3vw; border-radius:2vw; font-size:3.2vw; color:#5e17eb; flex-shrink:0; }

  /* ===== Modal ===== */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.4); }
  .modal{
    position: fixed; inset: 0; margin: auto; width: min(92vw, 440px);
    background: #fff; border-radius: 14px; padding: 5vw;
    box-shadow: 0 12px 36px rgba(0,0,0,.28);
    height: max-content; max-height: 80vh; display: grid; gap: 2vw;
  }
  .modal-title{ margin:0 0 .5rem 0; font-size:5vw; text-align:center; color:#2b2b2b; }
  .modal-text{ font-size:3.8vw; color:#444; text-align:center; }
  .modal-link{ margin-top:1vw; text-align:center; font-weight:700; color:#5e17eb; text-decoration:none; }
</style>
